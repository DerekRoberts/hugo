{{ define "main" }}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
  </header>

  <div class="post-content">
    <div class="contact-container">
      <div class="contact-info">
        <h2>Connecting</h2>
        <p>Having a conversation with a service provider can make a difference in how you may understand the services.</p>
        <p>Often, clients don't realize their core needs until they have a conversation and a sample session.</p>
        <p>Please fill out the form to book your time!</p>
      </div>

      <div class="contact-form-wrapper">
        <form id="contact-form" class="contact-form">
          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-group">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="6" required></textarea>
          </div>

          <button type="submit" class="submit-btn">Send the form</button>
        </form>

        <div id="form-status" class="form-status" style="display: none;"></div>
      </div>
    </div>

    <div class="contact-additional-content">
      {{ .Content }}
    </div>
  </div>
</article>

<style>
.contact-container {
  display: flex;
  gap: 2rem;
  margin-bottom: 3rem;
  flex-wrap: wrap;
}

.contact-info {
  flex: 1;
  min-width: 280px;
  background-color: #4a4a4a;
  color: white;
  padding: 2rem;
  border-radius: 4px;
}

.contact-info h2 {
  font-size: 2rem;
  margin-bottom: 1.5rem;
  font-weight: 300;
}

.contact-info p {
  margin-bottom: 1rem;
  line-height: 1.6;
}

.contact-form-wrapper {
  flex: 1.5;
  min-width: 320px;
}

.contact-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--content);
}

.form-group input,
.form-group textarea {
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  font-family: inherit;
  background-color: var(--entry);
  color: var(--content);
  transition: border-color 0.2s;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #5eb3b3;
}

.form-group textarea {
  resize: vertical;
  min-height: 120px;
}

.submit-btn {
  background-color: #5eb3b3;
  color: white;
  border: none;
  padding: 1rem 2rem;
  font-size: 1rem;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
  font-weight: 500;
}

.submit-btn:hover {
  background-color: #4a9999;
}

.submit-btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.form-status {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 4px;
  text-align: center;
}

.form-status.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.form-status.error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.contact-additional-content {
  margin-top: 2rem;
}

@media (max-width: 768px) {
  .contact-container {
    flex-direction: column;
  }
  
  .contact-info {
    min-width: 100%;
  }
  
  .contact-form-wrapper {
    min-width: 100%;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contact-form');
  const statusDiv = document.getElementById('form-status');
  const submitBtn = form.querySelector('.submit-btn');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    // Disable the submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    // Get form data
    const formData = new FormData(form);
    
    try {
      // Submit to Formspree (you'll need to configure this with your Formspree endpoint)
      // Alternative: Use Web3Forms, Formsubmit, or similar service
      // For now, using a GitHub Issue as backend through GitHub's API
      
      const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        message: document.getElementById('message').value
      };
      
      // Create issue title and body
      const issueTitle = `Contact Form: ${data.name}`;
      const issueBody = `**Name:** ${data.name}\n**Email:** ${data.email}\n\n**Message:**\n\n${data.message}\n\n---\n*Submitted via contact form at ${new Date().toISOString()}*`;
      
      // Try to create a GitHub issue (this works for public repos)
      const response = await fetch('https://api.github.com/repos/DerekRoberts/hugo/issues', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          title: issueTitle,
          body: issueBody,
          labels: ['contact-form']
        })
      });

      if (response.ok) {
        // Success
        statusDiv.className = 'form-status success';
        statusDiv.textContent = 'Thank you for your message! We will get back to you soon.';
        statusDiv.style.display = 'block';
        form.reset();
      } else if (response.status === 401 || response.status === 403) {
        // Authentication required - fallback to mailto
        const subject = `Contact Form - ${data.name}`;
        const body = `Name: ${data.name}\nEmail: ${data.email}\n\nMessage:\n${data.message}`;
        const mailtoLink = `mailto:info@metacurious.ca?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.location.href = mailtoLink;
        
        statusDiv.className = 'form-status success';
        statusDiv.textContent = 'Opening your email client... We\'ll get back to you soon!';
        statusDiv.style.display = 'block';
        form.reset();
      } else {
        throw new Error('Failed to submit form');
      }
    } catch (error) {
      console.error('Form submission error:', error);
      // Fallback to mailto
      const subject = `Contact Form - ${document.getElementById('name').value}`;
      const body = `Name: ${document.getElementById('name').value}\nEmail: ${document.getElementById('email').value}\n\nMessage:\n${document.getElementById('message').value}`;
      const mailtoLink = `mailto:info@metacurious.ca?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      
      window.location.href = mailtoLink;
      statusDiv.className = 'form-status success';
      statusDiv.textContent = 'Opening your email client... We\'ll get back to you soon!';
      statusDiv.style.display = 'block';
      form.reset();
    } finally {
      // Re-enable the submit button after a delay
      setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send the form';
      }, 2000);

      // Hide status message after 10 seconds
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 10000);
    }
  });
});
</script>

{{ end }}
